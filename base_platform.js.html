<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>base/platform.js - Documentation</title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="scripts/qrcode.js"></script>
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/custom.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>

    <section class="vimo">
        <div class="vimo__imgBox">
            <img class="vimo__imgBox--img" src="./asset/img/vimo.png">
        </div>

        <div class="vimo__title">
            <h2>VIMO</h2>
            <!--<p>beta</p>-->
            <p>基于Vue2.x的移动端Hybrid框架</p>
        </div>
        <div class="vimo__iframe">
            <iframe src="https://ghbtns.com/github-btn.html?user=DTFE&amp;repo=Vimo&amp;type=star&amp;count=true"
                    frameborder="0" scrolling="0" width="110px" height="20px"
                    class="enter-transition"
                    style=""></iframe>
            <iframe src="https://ghbtns.com/github-btn.html?user=DTFE&amp;repo=Vimo&amp;type=fork&amp;count=true"
                    frameborder="0" scrolling="0" width="95px" height="20px"
                    class="enter-transition"
                    style=""></iframe>
        </div>
    </section>
    <section class="nav__header"><h2><a href="index.html">首页 / Home</a></h2><h2><a href="https://dtfe.github.io/vimo-demo">示例 / Demo</a></h2><h2><a href="https://github.com/DTFE/vimo-start-kit">如何开始 / How To Start</a></h2><h2><a href="https://github.com/DTFE/Vimo/blob/master/CHANGELOG.md">更新日志 / Change Log</a></h2><h2><a href="#">常见问题 / Question</a></h2></section><h3>组件 / Components</h3><ul><li><a href="component-ActionSheet.html">ActionSheet</a><ul class='methods'><li data-type='method'><a href="component-ActionSheet.html#~dismiss">dismiss</a></li><li data-type='method'><a href="component-ActionSheet.html#~present">present</a></li></ul></li><li><a href="component-Alert.html">Alert</a><ul class='methods'><li data-type='method'><a href="component-Alert.html#~dismiss">dismiss</a></li><li data-type='method'><a href="component-Alert.html#~present">present</a></li></ul></li><li><a href="component-Avatar.html">Avatar</a></li><li><a href="component-Backdrop.html">Backdrop</a></li><li><a href="component-Badge.html">Badge</a></li><li><a href="component-Base_App.html">Base/App</a><ul class='methods'><li data-type='method'><a href="component-Base_App.html#~setClass">setClass</a></li><li data-type='method'><a href="component-Base_App.html#~setDisableScroll">setDisableScroll</a></li><li data-type='method'><a href="component-Base_App.html#~setDocTitle">setDocTitle</a></li><li data-type='method'><a href="component-Base_App.html#~setEnabled">setEnabled</a></li></ul></li><li><a href="component-Base_Content.html">Base/Content</a><ul class='methods'><li data-type='method'><a href="component-Base_Content.html#~getContentDimensions">getContentDimensions</a></li><li data-type='method'><a href="component-Base_Content.html#~resize">resize</a></li><li data-type='method'><a href="component-Base_Content.html#~scrollBy">scrollBy</a></li><li data-type='method'><a href="component-Base_Content.html#~scrollTo">scrollTo</a></li><li data-type='method'><a href="component-Base_Content.html#~scrollToBottom">scrollToBottom</a></li><li data-type='method'><a href="component-Base_Content.html#~scrollToElement">scrollToElement</a></li><li data-type='method'><a href="component-Base_Content.html#~scrollToTop">scrollToTop</a></li></ul></li><li><a href="component-Base_Footer.html">Base/Footer</a><ul class='methods'><li data-type='method'><a href="component-Base_Footer.html#~hide">hide</a></li><li data-type='method'><a href="component-Base_Footer.html#~setStyle">setStyle</a></li><li data-type='method'><a href="component-Base_Footer.html#~show">show</a></li><li data-type='method'><a href="component-Base_Footer.html#~toggle">toggle</a></li></ul></li><li><a href="component-Base_Header.html">Base/Header</a><ul class='methods'><li data-type='method'><a href="component-Base_Header.html#~hide">hide</a></li><li data-type='method'><a href="component-Base_Header.html#~setStyle">setStyle</a></li><li data-type='method'><a href="component-Base_Header.html#~show">show</a></li><li data-type='method'><a href="component-Base_Header.html#~toggle">toggle</a></li></ul></li><li><a href="component-Base_Nav.html">Base/Nav</a></li><li><a href="component-Base_Navbar.html">Base/Navbar</a><ul class='methods'><li data-type='method'><a href="component-Base_Navbar.html#~hideOptionButton">hideOptionButton</a></li><li data-type='method'><a href="component-Base_Navbar.html#~reset">reset</a></li><li data-type='method'><a href="component-Base_Navbar.html#~showOptionButton">showOptionButton</a></li><li data-type='method'><a href="component-Base_Navbar.html#~showPopMenu">showPopMenu</a></li></ul></li><li><a href="component-Base_Page.html">Base/Page</a></li><li><a href="component-Button.html">Button</a></li><li><a href="component-Card.html">Card</a></li><li><a href="component-Card_CardContent.html">Card/CardContent</a></li><li><a href="component-Card_CardHeader.html">Card/CardHeader</a></li><li><a href="component-Card_CardTitle.html">Card/CardTitle</a></li><li><a href="component-Checkbox.html">Checkbox</a></li><li><a href="component-ChooseCity.html">ChooseCity</a><ul class='methods'><li data-type='method'><a href="component-ChooseCity.html#~present">present</a></li></ul></li><li><a href="component-CityPicker.html">CityPicker</a></li><li><a href="component-Datetime.html">Datetime</a></li><li><a href="component-Fab.html">Fab</a><ul class='methods'><li data-type='method'><a href="component-Fab.html#~close">close</a></li></ul></li><li><a href="component-Fab_FabButton.html">Fab/FabButton</a></li><li><a href="component-Fab_FabList.html">Fab/FabList</a></li><li><a href="component-Feedback.html">Feedback</a><ul class='methods'><li data-type='method'><a href="component-Feedback.html#~destroy">destroy</a></li><li data-type='method'><a href="component-Feedback.html#~update">update</a></li></ul></li><li><a href="component-Grid.html">Grid</a></li><li><a href="component-Grid_Column.html">Grid/Column</a></li><li><a href="component-Grid_Row.html">Grid/Row</a></li><li><a href="component-Icon.html">Icon</a></li><li><a href="component-Img.html">Img</a></li><li><a href="component-Indicator.html">Indicator</a><ul class='methods'><li data-type='method'><a href="component-Indicator.html#.dismiss">dismiss</a></li><li data-type='method'><a href="component-Indicator.html#.present">present</a></li></ul></li><li><a href="component-InfiniteScroll.html">InfiniteScroll</a><ul class='methods'><li data-type='method'><a href="component-InfiniteScroll.html#~complete">complete</a></li><li data-type='method'><a href="component-InfiniteScroll.html#~enable">enable</a></li><li data-type='method'><a href="component-InfiniteScroll.html#~waitFor">waitFor</a></li></ul></li><li><a href="component-InfiniteScroll_InfiniteScrollContent.html">InfiniteScroll/InfiniteScrollContent</a></li><li><a href="component-Input.html">Input</a></li><li><a href="component-Item.html">Item</a></li><li><a href="component-Item_ItemDivider.html">Item/ItemDivider</a></li><li><a href="component-Item_ItemGroup.html">Item/ItemGroup</a></li><li><a href="component-Item_ListHeader.html">Item/ListHeader</a></li><li><a href="component-Label.html">Label</a></li><li><a href="component-List.html">List</a></li><li><a href="component-Loading.html">Loading</a><ul class='methods'><li data-type='method'><a href="component-Loading.html#~dismiss">dismiss</a></li><li data-type='method'><a href="component-Loading.html#~present">present</a></li></ul></li><li><a href="component-Menus.html">Menus</a><ul class='methods'><li data-type='method'><a href="component-Menus.html#~close">close</a></li><li data-type='method'><a href="component-Menus.html#~open">open</a></li><li data-type='method'><a href="component-Menus.html#~toggle">toggle</a></li></ul></li><li><a href="component-Modal.html">Modal</a><ul class='methods'><li data-type='method'><a href="component-Modal.html#~dismiss">dismiss</a></li><li data-type='method'><a href="component-Modal.html#~present">present</a></li></ul></li><li><a href="component-Note.html">Note</a></li><li><a href="component-NoticeBar.html">NoticeBar</a><ul class='methods'><li data-type='method'><a href="component-NoticeBar.html#~close">close</a></li></ul></li><li><a href="component-Picker.html">Picker</a><ul class='methods'><li data-type='method'><a href="component-Picker.html#~dismiss">dismiss</a></li><li data-type='method'><a href="component-Picker.html#~present">present</a></li></ul></li><li><a href="component-Popover.html">Popover</a><ul class='methods'><li data-type='method'><a href="component-Popover.html#~dismiss">dismiss</a></li><li data-type='method'><a href="component-Popover.html#~present">present</a></li></ul></li><li><a href="component-PreviewImage.html">PreviewImage</a></li><li><a href="component-Radio.html">Radio</a></li><li><a href="component-Range.html">Range</a></li><li><a href="component-Refresher.html">Refresher</a><ul class='methods'><li data-type='method'><a href="component-Refresher.html#~cancel">cancel</a></li><li data-type='method'><a href="component-Refresher.html#~complete">complete</a></li></ul></li><li><a href="component-Refresher_RefresherContent.html">Refresher/RefresherContent</a></li><li><a href="component-Scroll.html">Scroll</a></li><li><a href="component-ScrollSegment.html">ScrollSegment</a></li><li><a href="component-ScrollSegment_ScrollSegmentButton.html">ScrollSegment/ScrollSegmentButton</a></li><li><a href="component-Searchbar.html">Searchbar</a><ul class='methods'><li data-type='method'><a href="component-Searchbar.html#~setFocus">setFocus</a></li></ul></li><li><a href="component-Segment.html">Segment</a></li><li><a href="component-Segment_SegmentButton.html">Segment/SegmentButton</a></li><li><a href="component-Select.html">Select</a></li><li><a href="component-Select_SelectOption.html">Select/SelectOption</a></li><li><a href="component-Separation.html">Separation</a></li><li><a href="component-Sheet.html">Sheet</a><ul class='methods'><li data-type='method'><a href="component-Sheet.html#~dismiss">dismiss</a></li><li data-type='method'><a href="component-Sheet.html#~present">present</a></li></ul></li><li><a href="component-SlideBox.html">SlideBox</a><ul class='methods'><li data-type='method'><a href="component-SlideBox.html#~cancel">cancel</a></li><li data-type='method'><a href="component-SlideBox.html#~checking">checking</a></li><li data-type='method'><a href="component-SlideBox.html#~complete">complete</a></li><li data-type='method'><a href="component-SlideBox.html#~fail">fail</a></li></ul></li><li><a href="component-Slides.html">Slides</a></li><li><a href="component-Slides_Slide.html">Slides/Slide</a></li><li><a href="component-SlidesLite.html">SlidesLite</a></li><li><a href="component-SlidesLite_Slide.html">SlidesLite/Slide</a></li><li><a href="component-Spinner.html">Spinner</a></li><li><a href="component-Tabs.html">Tabs</a><ul class='methods'><li data-type='method'><a href="component-Tabs.html#~getActivatedIndex">getActivatedIndex</a></li><li data-type='method'><a href="component-Tabs.html#~getByIndex">getByIndex</a></li><li data-type='method'><a href="component-Tabs.html#~getSelected">getSelected</a></li><li data-type='method'><a href="component-Tabs.html#~select">select</a></li></ul></li><li><a href="component-Tabs_Tab.html">Tabs/Tab</a></li><li><a href="component-Textarea.html">Textarea</a><ul class='methods'><li data-type='method'><a href="component-Textarea.html#~destroy">destroy</a></li><li data-type='method'><a href="component-Textarea.html#~update">update</a></li></ul></li><li><a href="component-Thumbnail.html">Thumbnail</a></li><li><a href="component-Toast.html">Toast</a></li><li><a href="component-Toggle.html">Toggle</a></li><li><a href="component-Toolbar.html">Toolbar</a></li><li><a href="component-Toolbar_Buttons.html">Toolbar/Buttons</a></li><li><a href="component-Toolbar_Title.html">Toolbar/Title</a><ul class='methods'><li data-type='method'><a href="component-Toolbar_Title.html#~getTitle">getTitle</a></li><li data-type='method'><a href="component-Toolbar_Title.html#~reset">reset</a></li><li data-type='method'><a href="component-Toolbar_Title.html#~setTitle">setTitle</a></li><li data-type='method'><a href="component-Toolbar_Title.html#~setTitleColor">setTitleColor</a></li></ul></li></ul><h3>类 / Classes</h3><ul><li><a href="Config.html">Config</a><ul class='methods'><li data-type='method'><a href="Config.html#cache">cache</a></li><li data-type='method'><a href="Config.html#get">get</a></li><li data-type='method'><a href="Config.html#getBoolean">getBoolean</a></li><li data-type='method'><a href="Config.html#getNumber">getNumber</a></li><li data-type='method'><a href="Config.html#set">set</a></li><li data-type='method'><a href="Config.html#settings">settings</a></li></ul></li><li><a href="History.html">History</a><ul class='methods'><li data-type='method'><a href="History.html#canGoBack">canGoBack</a></li><li data-type='method'><a href="History.html#getDirection">getDirection</a></li><li data-type='method'><a href="History.html#getHistory">getHistory</a></li><li data-type='method'><a href="History.html#toRoot">toRoot</a></li></ul></li><li><a href="Platform.html">Platform</a><ul class='methods'><li data-type='method'><a href="Platform.html#exitApp">exitApp</a></li><li data-type='method'><a href="Platform.html#height">height</a></li><li data-type='method'><a href="Platform.html#is">is</a></li><li data-type='method'><a href="Platform.html#isLandscape">isLandscape</a></li><li data-type='method'><a href="Platform.html#isPortrait">isPortrait</a></li><li data-type='method'><a href="Platform.html#lang">lang</a></li><li data-type='method'><a href="Platform.html#navigatorPlatform">navigatorPlatform</a></li><li data-type='method'><a href="Platform.html#networkType">networkType</a></li><li data-type='method'><a href="Platform.html#onNetworkChange">onNetworkChange</a></li><li data-type='method'><a href="Platform.html#platforms">platforms</a></li><li data-type='method'><a href="Platform.html#ready">ready</a></li><li data-type='method'><a href="Platform.html#userAgent">userAgent</a></li><li data-type='method'><a href="Platform.html#versions">versions</a></li><li data-type='method'><a href="Platform.html#width">width</a></li></ul></li></ul><h3>模块 / Modules</h3><ul><li><a href="module-Util.html">Util</a><ul class='methods'><li data-type='method'><a href="module-Util.html#.clamp">clamp</a></li><li data-type='method'><a href="module-Util.html#.defaults">defaults</a></li><li data-type='method'><a href="module-Util.html#.docReady">docReady</a></li><li data-type='method'><a href="module-Util.html#.firstUpperCase">firstUpperCase</a></li><li data-type='method'><a href="module-Util.html#.focusOutActiveElement">focusOutActiveElement</a></li><li data-type='method'><a href="module-Util.html#.hasClass">hasClass</a></li><li data-type='method'><a href="module-Util.html#.hasFocus">hasFocus</a></li><li data-type='method'><a href="module-Util.html#.isActive">isActive</a></li><li data-type='method'><a href="module-Util.html#.isArray">isArray</a></li><li data-type='method'><a href="module-Util.html#.isBlank">isBlank</a></li><li data-type='method'><a href="module-Util.html#.isBoolean">isBoolean</a></li><li data-type='method'><a href="module-Util.html#.isCheckedProperty">isCheckedProperty</a></li><li data-type='method'><a href="module-Util.html#.isDate">isDate</a></li><li data-type='method'><a href="module-Util.html#.isDefined">isDefined</a></li><li data-type='method'><a href="module-Util.html#.isFunction">isFunction</a></li><li data-type='method'><a href="module-Util.html#.isNumber">isNumber</a></li><li data-type='method'><a href="module-Util.html#.isObject">isObject</a></li><li data-type='method'><a href="module-Util.html#.isPassive">isPassive</a></li><li data-type='method'><a href="module-Util.html#.isPlainObject">isPlainObject</a></li><li data-type='method'><a href="module-Util.html#.isPresent">isPresent</a></li><li data-type='method'><a href="module-Util.html#.isPrimitive">isPrimitive</a></li><li data-type='method'><a href="module-Util.html#.isRegexp">isRegexp</a></li><li data-type='method'><a href="module-Util.html#.isString">isString</a></li><li data-type='method'><a href="module-Util.html#.isTrueProperty">isTrueProperty</a></li><li data-type='method'><a href="module-Util.html#.isUndefined">isUndefined</a></li><li data-type='method'><a href="module-Util.html#.parsePxUnit">parsePxUnit</a></li><li data-type='method'><a href="module-Util.html#.pointerCoord">pointerCoord</a></li><li data-type='method'><a href="module-Util.html#.registerListener">registerListener</a></li><li data-type='method'><a href="module-Util.html#.setElementClass">setElementClass</a></li><li data-type='method'><a href="module-Util.html#.transitionEnd">transitionEnd</a></li><li data-type='method'><a href="module-Util.html#.urlChange">urlChange</a></li></ul></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">

    <article class="content">

        
        <h1 class="page-title">base/platform.js</h1>
        

        




    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @class Platform
 * @classdesc  **App平台级别**的初始化类
 *
 *
 * ## 说明
 *
 * 这个类用于从设备中获取平台信息, 比如设备种类/运行平台/设备方向/文字方向等, 以此使得代码适配所有机型. 此外, 还支持平台方法的注册, 使业务与平台解耦.
 *
 */

/**
 * 结构体定义
 *
 * @typedef {Object} PlatformConfig
 * {
 *    isEngine?: boolean;
 *    initialize?: Function;
 *    isMatch?: Function;
 *    superset?: string;
 *    subsets?: string[];
 *    settings?: any;
 *    versionParser?: any;
 * }
 *
 * @typedef {Object} PlatformVersion
 * {
 *    str?: string;
 *    num?: number;
 *    major?: number;
 *    minor?: number;
 * }
 *
 * */

import { defaults, isFunction, isObject, isPresent } from '../util/util'
import PLATFORM_DEFAULT_CONFIGS from './platform-default-configs'

class Platform {
  constructor () {
    // Ready的promise;
    this._readyPromise = new Promise((resolve, reject) => {
      this._readyResolve = resolve
      this._readyReject = reject
    })

    this._versions = {} // 当前平台的版本信息列表 PlatformVersion

    this._lang = null // string 文字;

    this._qp = null // QueryParams [[初始化时]]!!! 的url查询实例 {data:{}};

    this._bPlt = null // string 当前的浏览器平台,差不多是设备的类型 navigator.platform , 例如MacIntel;
    this._ua = null // string userAgent;

    this._default = null // string 如果rootNode不存则使用默认的配置
    this._platforms = [] // : string[] = []; 当前平台的key 例如: "mobile/ios/mobileweb"
    this._registry = null // {[name:string] : PlatformConfig}; platform-registry中的config列表->登记处

    this._pW = 0 // Portrait模式的设备Width
    this._pH = 0 // Portrait模式的设备Height
    this._lW = 0 // Landscape模式的设备Width
    this._lH = 0 // Landscape模式的设备Height
    this._isPortrait = null // boolean = null 横屏还是竖屏 Portrait=竖屏;

    this._nt = null // 记录网络类型

    this._networkChangeCallbacks = []

    this.css = {
      transform: null,
      transition: null,
      transitionDuration: null,
      transitionDelay: null,
      transitionTimingFn: null,
      transitionStart: null,
      transitionEnd: null,
      transformOrigin: null,
      animationDelay: null
    }
  }

  /**
   * 判断当前平台是否匹配
   * 目前支持的平台判断有: mobile/ios/android/wechat/alipay/dingtalk/qq
   * @param {string} platformName - 平台名称
   * @return {boolean}
   */
  is (platformName) {
    return this._platforms.indexOf(platformName) > -1
  }

  /**
   * 获取当前的平台信息, 大类为: 设备别(mobile)/操作系统(ios/andoid)/hybrid平台(wechat/alipay/..)
   * 例如在ios上的微信, 则返回: ['mobile','ios','wechat']
   * @returns {array} 平台的类别的数组
   */
  platforms () {
    return this._platforms
  }

  /**
   * 返回当前平台的全部版本信息
   * @returns {object}
   */
  versions () {
    return this._versions
  }

  /**
   * 返回当前平台有值的版本信息
   * @return {PlatformVersion}
   * @private
   */
  version () {
    for (var platformName in this._versions) {
      if (this._versions[platformName]) {
        return this._versions[platformName]
      }
    }
    return {}
  }

  // Ready相关
  // **********************************************

  /**
   * 当平台准备完毕触发promise的resolve方法, 可以在业务中像下面这样使用.
   * 例如微信, 当ready之后, 即可获取及配置config信息和bridge方法注册, 因为当前JSSdk都已加载完毕.
   *
   * ```
   *  this.$platform.ready().then((data) => {
   *    console.debug(data)
   *  })
   * ```
   * @returns {promise}
   */
  ready () {
    return this._readyPromise
  }

  /**
   * 当平台准备完毕的时执行resolve方法, 这段函数执行后, 执行ready
   * @param {string} readySource - resolve中传入的数据
   * @private
   */
  triggerReady (readySource) {
    this._readyResolve(readySource)
  }

  /**
   * 平台初始化失败的回调
   * @param {string} rejectSource - reject中传入的数据
   * @private
   */
  triggerFail (rejectSource) {
    this._readyReject(rejectSource)
  }

  /**
   * 这个函数是默认函数, 当平台没有initialize函数改写prepareReady的时候, 将使用这个.
   *
   * 平台在initialize函数中改写prepareReady是为了在App运行环境中做一些处理,
   * 比如必须的资源下载/请求后台给地址签名等. 等完毕后, 手动触发triggerReady函数
   *
   * 这部分不应该和业务相关, 比如获取用户数据才进入app, 这部分应该业务逻辑中处理
   *
   * !!!! platform配置中的initialize 只进行平台配置及注册签名等的代码, 而不进行和具体业务相关的代码!!!!
   * !!!! platform配置中的initialize 只进行平台配置及注册签名等的代码, 而不进行和具体业务相关的代码!!!!
   * !!!! platform配置中的initialize 只进行平台配置及注册签名等的代码, 而不进行和具体业务相关的代码!!!!
   *
   * @private
   */
  beforeReady () {
    this.triggerReady('H5 Initialization Process!')
  }

  // 平台方法
  // **********************************************

  /**
   * 退出app
   * @hidden
   */
  exitApp () {
    console.error('H5未实现此方法, 请检查调用!')
  }

  /**
   * 设置网络类型
   * @private
   * */
  setNetworkType (networkType) {
    this._nt = networkType
  }

  /**
   * 获取网络类型, 如果是在平台, 则使用平台方法
   * */
  networkType () {
    return this._nt
  }

  /**
   * 当网络环境发生变化时触发注册函数
   * @param {Function} fn - 注册函数, 回调参数返回网络类型
   * */
  onNetworkChange (fn) {
    if (
      isPresent(fn) &amp;&amp;
      isFunction(fn) &amp;&amp;
      this._networkChangeCallbacks.indexOf(fn) === -1
    ) {
      this._networkChangeCallbacks.push(fn)
    }
  }

  /**
   * @private
   */
  setCssProps (docElement) {
    this.css = getCss(docElement)
    return this.css
  }

  /**
   * 获取UA
   * @return {string}
   */
  userAgent () {
    return this._ua || ''
  }

  /**
   * @param {string} userAgent
   * @private
   */
  setUserAgent (userAgent) {
    this._ua = userAgent
  }

  /**
   * Get the query string parameter
   * @private
   */
  getQueryParam (key) {
    return this._qp.get(key)
  }

  /**
   * @param {QueryParams} queryParams
   * @private
   */
  setQueryParams (queryParams) {
    this._qp = queryParams
  }

  /**
   * 获取浏览器信息
   * @return {string}
   */
  navigatorPlatform () {
    return this._bPlt || ''
  }

  /**
   * 设置浏览器平台的名称
   * @param {string} navigatorPlatform
   * @private
   */
  setNavigatorPlatform (navigatorPlatform) {
    this._bPlt = navigatorPlatform
  }

  /**
   * 在html标签中设置app语言类型
   * @param {string} language  Examples: `en-US`, `en-GB`, `ar`, `de`, `zh`, `es-MX`
   * @param {boolean} updateDocument
   * @private
   */
  setLang (language, updateDocument) {
    this._lang = language
    if (updateDocument) {
      document.documentElement.setAttribute('lang', language)
    }
  }

  /**
   * 返回app的语言类型
   * @returns {string}
   */
  lang () {
    return this._lang
  }

  // 屏幕尺寸及方向
  // **********************************************
  /**
   * 获取当前viewport的宽度
   * @return {number}
   */
  width () {
    this._calcDim()
    return this._isPortrait ? this._pW : this._lW
  }

  /**
   * 获取当前viewport的高度
   * @return {number}
   */
  height () {
    this._calcDim()
    return this._isPortrait ? this._pH : this._lH
  }

  /**
   * 判断是否为纵向
   * (landscape是横向，portrait是纵向)
   * @return {boolean}
   */
  isPortrait () {
    this._calcDim()
    return this._isPortrait
  }

  /**
   * 判断是否为横向
   * (landscape是横向，portrait是纵向)
   * @return {boolean}
   */
  isLandscape () {
    return !this.isPortrait()
  }

  /**
   * @private
   */
  _calcDim () {
    if (window.screen.width > 0 &amp;&amp; window.screen.height > 0) {
      if (window['innerWidth'] &lt; window['innerHeight']) {
        // the device is in portrait
        if (this._pW &lt;= window['innerWidth']) {
          // console.debug('setting _isPortrait to true');
          this._isPortrait = true
          this._pW = window['innerWidth']
        }
        if (this._pH &lt;= window['innerHeight']) {
          // console.debug('setting _isPortrait to true');
          this._isPortrait = true
          this._pH = window['innerHeight']
        }
      } else {
        if (this._lW > window['innerWidth']) {
          // Special case: keyboard is open and device is in portrait
          // console.debug('setting _isPortrait to true while keyboard is open and device is portrait');
          this._isPortrait = true
        }
        // the device is in landscape
        if (this._lW &lt;= window['innerWidth']) {
          // console.debug('setting _isPortrait to false');
          this._isPortrait = false
          this._lW = window['innerWidth']
        }
        if (this._lH &lt;= window['innerHeight']) {
          // console.debug('setting _isPortrait to false');
          this._isPortrait = false
          this._lH = window['innerHeight']
        }
      }
    }
  }

  // Platform Registry
  // **********************************************

  /**
   * 设置config的 登记列表, platform-registry中的config就登记在这个位置
   * @param {PlatformConfig} platformConfigs {[key: string]: PlatformConfig}
   * @private
   */
  setPlatformConfigs (platformConfigs) {
    this._registry = platformConfigs || {}
  }

  /**
   * @param {string} platformName
   * @return {PlatformConfig} platformConfigs - {[key: string]: PlatformConfig}
   * @private
   */
  getPlatformConfig (platformName) {
    return this._registry[platformName] || {}
  }

  /**
   * 获得当前的登记列表
   * @private
   */
  registry () {
    return this._registry
  }

  /**
   * 设置默认的登记config名称
   * @param {string}
   * @private
   */
  setDefault (platformName) {
    this._default = platformName
  }

  /**
   * 判断 字符串是否在 长字符串中
   * @param {string} queryValue  ios;md;android;iphone
   * @param {string} queryTestValue  ios
   * @return {boolean}
   * @private
   */
  testQuery (queryValue, queryTestValue) {
    const valueSplit = queryValue.toLowerCase().split(';')
    return valueSplit.indexOf(queryTestValue) > -1
  }

  /**
   * 判断是否匹配当前的浏览器平台
   * @param {RegExp} navigatorPlatformExpression
   * @private
   */
  testNavigatorPlatform (navigatorPlatformExpression) {
    const rgx = new RegExp(navigatorPlatformExpression, 'i')
    return rgx.test(this._bPlt)
  }

  /**
   * 判断是否匹配当前的userAgent
   * @param {RegExp} userAgentExpression
   * @private
   */
  matchUserAgentVersion (userAgentExpression) {
    if (this._ua &amp;&amp; userAgentExpression) {
      const val = this._ua.match(userAgentExpression)
      if (val) {
        return {
          major: val[1],
          minor: val[2],
          third: val[3]
        }
      }
    }
  }

  /**
   * 判断是否匹配当前的userAgent
   * @param {RegExp} expression
   * @private
   */
  testUserAgent (expression) {
    if (this._ua) {
      return this._ua.indexOf(expression) >= 0
    }
    return false
  }

  /**
   *  this._qp为地址栏参数查询对象,
   *  1. 优先提取地址栏的platform值,判断是否匹配
   *  2. 否则由useragent判断userAgentAtLeastHas中是否有而userAgentMustNotHave中没有
   *
   * @param {string} queryStringName - 通过地址栏的platform参数查询名称
   * @param {array} userAgentAtLeastHas - 在useragent中查找的字段
   * @param {array} userAgentMustNotHave -  在useragent中排除的字段
   * @return {boolean}
   * @private
   */
  isPlatformMatch (
    queryStringName,
    userAgentAtLeastHas,
    userAgentMustNotHave = []
  ) {
    // platform可以取值的参数: ios/android/iphone/
    const queryValue = this._qp.get('platform')
    if (queryValue) {
      return this.testQuery(queryValue, queryStringName)
    }

    userAgentAtLeastHas = userAgentAtLeastHas || [queryStringName]

    const userAgent = this._ua.toLowerCase()

    for (var i = 0; i &lt; userAgentAtLeastHas.length; i++) {
      if (userAgent.indexOf(userAgentAtLeastHas[i]) > -1) {
        for (var j = 0; j &lt; userAgentMustNotHave.length; j++) {
          if (userAgent.indexOf(userAgentMustNotHave[j]) > -1) {
            return false
          }
        }
        return true
      }
    }

    return false
  }

  /** @private */
  init () {
    // 计算屏幕尺寸
    this._calcDim()

    this._platforms = []
    let rootPlatformNode // 根节点Node;
    let enginePlatformNode // engine节点Node;
    // figure out the most specific platform and active engine
    let tmpPlatform // 临时缓存Node;

    // 找到rootPlatformNode
    // 找到enginePlatformNode
    for (let platformName in this._registry) {
      // 将platformName对用的配置转化为Node对象, 返回rootNode
      tmpPlatform = this.matchPlatform(platformName)
      if (tmpPlatform) {
        // we found a platform match!
        // check if its more specific than the one we already have

        if (tmpPlatform.isEngine) {
          // because it matched then this should be the active engine
          // you cannot have more than one active engine
          enginePlatformNode = tmpPlatform
        } else if (
          !rootPlatformNode ||
          tmpPlatform.depth > rootPlatformNode.depth
        ) {
          // only find the root node for platforms that are not engines
          // set this node as the root since we either don't already
          // have one, or this one is more specific that the current one
          rootPlatformNode = tmpPlatform
        }
      }
    }

    // 如果没找到根rootNode则使用默认的_default
    if (!rootPlatformNode) {
      rootPlatformNode = new PlatformNode(this._registry, this._default)
    }

    // build a Platform instance filled with the
    // hierarchy of active platforms and settings

    if (rootPlatformNode) {
      // check if we found an engine node (cordova/node-webkit/etc)
      // 如果是在壳子中,则将壳子的节点放置为rootNode
      if (enginePlatformNode) {
        // add the engine to the first in the platform hierarchy
        // the original rootPlatformNode now becomes a child
        // of the engineNode, which is not the new root
        enginePlatformNode.child = rootPlatformNode
        rootPlatformNode.parent = enginePlatformNode
        rootPlatformNode = enginePlatformNode
      }

      // 从根节点开始, 插入子Node
      let platformNode = rootPlatformNode
      while (platformNode) {
        insertSuperset(this._registry, platformNode)
        platformNode = platformNode.child
      }

      // make sure the root noot is actually the root
      // in case a node was inserted before the root
      platformNode = rootPlatformNode.parent
      while (platformNode) {
        rootPlatformNode = platformNode
        platformNode = platformNode.parent
      }

      platformNode = rootPlatformNode

      // 在这里初始化平台
      while (platformNode) {
        platformNode.beforeInitialize(this)

        platformNode.initialize(this)

        // 设置当前激活的平台信息, 最后一个是最重要的
        this._platforms.push(platformNode.name)

        // get the platforms version if a version parser was provided
        this._versions[platformNode.name] = platformNode.version(this)

        // go to the next platform child
        platformNode = platformNode.child
      }
    }
  }

  /**
   * 传入的名称匹配当前的平台,如果匹配则返回rootNode
   * @param {string} platformName
   * @return {PlatformNode}
   * @private
   */
  matchPlatform (platformName) {
    // build a PlatformNode and assign config data to it
    // use it's getRoot method to build up its hierarchy
    // depending on which platforms match
    let platformNode = new PlatformNode(this._registry, platformName)
    let rootNode = platformNode.getRoot(this)

    if (rootNode) {
      rootNode.depth = 0
      let childPlatform = rootNode.child
      while (childPlatform) {
        rootNode.depth++
        childPlatform = childPlatform.child
      }
    }
    return rootNode
  }
}

/**
 * @private
 * */
class PlatformNode {
  /**
   * 读取c中的配置信息
   * @param {PlatformConfig} registry
   * @param {string} platformName
   * */
  constructor (registry, platformName) {
    this.parent = null // 父节点
    this.child = null // 子节点
    this.depth = null // number 当前节点的深度;
    this.registry = registry
    this.c = registry[platformName] // platform-registry配置中的平台设置;
    this.name = platformName // 当前节点的名称;
    this.isEngine = this.c &amp;&amp; this.c.isEngine // boolean; 是否是在壳子中
  }

  // 获取settings配置
  settings () {
    return this.c.settings || {}
  }

  // 获取父集的名称
  superset () {
    return this.c.superset
  }

  /**
   * 执行配置的匹配函数, 判断现在的node是否匹配当前运行平台
   * @param {Platform} p
   * @return {boolean}
   * */
  isMatch (p) {
    return this.c.isMatch &amp;&amp; this.c.isMatch(p)
  }

  /**
   * 初始化之前执行的函数
   * @param {Platform} platform
   * */
  beforeInitialize (platform) {
    this.c.beforeInitialize &amp;&amp; this.c.beforeInitialize(platform)
  }

  /**
   * 执行配置的初始化函数, 传入当前平台的参数
   * @param {Platform} platform
   * */
  initialize (platform) {
    this.c.initialize &amp;&amp; this.c.initialize(platform)
  }

  /**
   * 传入当前的平台信息, 获得版本信息
   * @param {Platform} p
   * @return {PlatformVersion}
   * */
  version (p) {
    if (this.c.versionParser) {
      const v = this.c.versionParser(p)
      if (v) {
        if (!v.major) v.major = '0'
        if (!v.minor) v.minor = '0'
        if (!v.third) v.third = '0'
        const str = v.major + '.' + v.minor + (v.third ? '.' + v.third : '')
        return {
          str: str,
          num: parseFloat(str),
          major: parseInt(v.major, 10),
          minor: parseInt(v.minor, 10),
          third: parseInt(v.third, 10)
        }
      }
    }
  }

  /**
   * 获得当前node的根node
   * @param {Platform} p
   * @return {PlatformNode}
   * */
  getRoot (p) {
    // 判断当前平台是否和当前的Node匹配
    if (this.isMatch(p)) {
      // 获得 父集名称 列表
      let parents = this.getSubsetParents(this.name)

      if (!parents.length) {
        return this
      }

      let platformNode = null // PlatformNode
      let rootPlatformNode = null // PlatformNode

      for (let i = 0; i &lt; parents.length; i++) {
        platformNode = new PlatformNode(this.registry, parents[i])
        platformNode.child = this

        rootPlatformNode = platformNode.getRoot(p)
        if (rootPlatformNode) {
          this.parent = platformNode
          return rootPlatformNode
        }
      }
    }

    return null
  }

  /**
   * 获取 子集名称对应的父集列表
   * @param {string} subsetPlatformName
   * @return {array}
   * */
  getSubsetParents (subsetPlatformName) {
    const parentPlatformNames = []
    let platform = null // PlatformConfig
    for (let platformName in this.registry) {
      platform = this.registry[platformName]

      if (
        platform.subsets &amp;&amp;
        platform.subsets.indexOf(subsetPlatformName) > -1
      ) {
        parentPlatformNames.push(platformName)
      }
    }

    return parentPlatformNames
  }
}

/**
 * 当前环境的可用CSS变量名称
 * 下方自动执行
 * @param {HTMLElement} docEle
 * @private
 * */
function getCss (docEle) {
  const css = {
    transform: null,
    transition: null,
    transitionDuration: null,
    transitionDelay: null,
    transitionTimingFn: null,
    transitionStart: null,
    transitionEnd: null,
    transformOrigin: null,
    animationDelay: null
  }

  // transform
  var i
  var keys = [
    'webkitTransform',
    '-webkit-transform',
    'webkit-transform',
    'transform'
  ]

  for (i = 0; i &lt; keys.length; i++) {
    if (docEle.style[keys[i]] !== undefined) {
      css.transform = keys[i]
      break
    }
  }

  // transition
  keys = ['webkitTransition', 'transition']
  for (i = 0; i &lt; keys.length; i++) {
    if (docEle.style[keys[i]] !== undefined) {
      css.transition = keys[i]
      break
    }
  }

  // The only prefix we care about is webkit for transitions.
  var isWebkit = css.transition.indexOf('webkit') > -1

  // transition duration
  css.transitionDuration = (isWebkit ? '-webkit-' : '') + 'transition-duration'

  // transition timing function
  css.transitionTimingFn =
    (isWebkit ? '-webkit-' : '') + 'transition-timing-function'

  // transition delay
  css.transitionDelay = (isWebkit ? '-webkit-' : '') + 'transition-delay'

  // To be sure transitionend works everywhere, include *both* the webkit and non-webkit events
  css.transitionEnd = (isWebkit ? 'webkitTransitionEnd ' : '') + 'transitionend'

  // transform origin
  css.transformOrigin = (isWebkit ? '-webkit-' : '') + 'transform-origin'

  // animation delay
  css.animationDelay = isWebkit ? 'webkitAnimationDelay' : 'animationDelay'

  return css
}

/**
 * @param {any} registry
 * @param {PlatformNode} platformNode
 * @private
 * */
function insertSuperset (registry, platformNode) {
  let supersetPlatformName = platformNode.superset()
  if (supersetPlatformName) {
    // add a platform in between two exist platforms
    // so we can build the correct hierarchy of active platforms
    let supersetPlatform = new PlatformNode(registry, supersetPlatformName)
    supersetPlatform.parent = platformNode.parent
    supersetPlatform.child = platformNode
    if (supersetPlatform.parent) {
      supersetPlatform.parent.child = supersetPlatform
    }
    platformNode.parent = supersetPlatform
  }
}

/**
 * 获取url参数的类
 * @example
 * import {QueryParams} from './platform/query-params'
 * let a = (new QueryParams()).queryParams(location.href)
 * console.log(a.data);
 * => Object {a: "1", b: "3"}
 * @private
 */
export class QueryParams {
  /**
   * @param {string} url
   * */
  constructor (url = window.location.href) {
    this.data = {} // {[key: string]: any}
    this.parseUrl(url)
  }

  /**
   * @param {string} key
   * */
  get (key) {
    return this.data[key.toLowerCase()]
  }

  /**
   * @param {string} url
   * */
  parseUrl (url) {
    if (url) {
      const startIndex = url.indexOf('?')
      if (startIndex > -1) {
        const queries = url.slice(startIndex + 1).split('&amp;')
        for (var i = 0; i &lt; queries.length; i++) {
          if (queries[i].indexOf('=') > 0) {
            var split = queries[i].split('=')
            if (split.length > 1) {
              this.data[split[0].toLowerCase()] = split[1].split('#')[0]
            }
          }
        }
      }
    }
    return this.data
  }
}

/**
 * @param {object} config - 用户在外面定义的平台配置, 需要和默认配置整合
 * @private
 * */
export function setupPlatform (config = {}) {
  const p = new Platform()
  let _finalConf = PLATFORM_DEFAULT_CONFIGS

  for (let outerKey in config) {
    if (_finalConf[outerKey] &amp;&amp; isObject(_finalConf[outerKey])) {
      let _cusConf = config[outerKey]
      let _defConf = _finalConf[outerKey]
      for (let innerKey in _cusConf) {
        let _tmp = {}
        _tmp = defaults(_cusConf[innerKey], _defConf[innerKey])
        _defConf[innerKey] = _tmp
      }
    } else {
      _finalConf[outerKey] = config[outerKey]
    }
  }

  // 更新 IOS/Android下的subsets属性, 可能存在subsets中未定义的平台
  let keys = Object.keys(_finalConf).filter(item => {
    return item !== 'mobile' &amp;&amp; item !== 'android' &amp;&amp; item !== 'ios'
  })
  _finalConf.android.subsets = keys
  _finalConf.ios.subsets = keys

  p.setDefault('core')
  p.setPlatformConfigs(_finalConf)
  p.setQueryParams(new QueryParams())
  !p.navigatorPlatform() &amp;&amp; p.setNavigatorPlatform(window.navigator.platform)
  !p.userAgent() &amp;&amp; p.setUserAgent(window.navigator.userAgent)
  !p.lang() &amp;&amp; p.setLang('zh-cn', true)

  // 设置css类型
  p.setCssProps(document.documentElement)

  p.init()

  // 触发ready, 一般情况下是dom ready,
  // 如果平台改写了prepareReady方法,
  // 则执行平台对应的ready处理
  p.beforeReady()
  return p
}
</code></pre>
        </article>
    </section>





    </article>
</div>

<br class="clear">

<!--<footer>-->
    <!--文档根据<a href="https://github.com/DTFE/Vimo">Vimo源码</a>由<a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>自动生成, 主题修改自<a href="https://github.com/clenemt/docdash">docdash</a>, 并增加了 @component / @demo / @props / @slot / @usage 增强标注.-->
<!--</footer>-->

<footer>
    文档根据<a href="https://github.com/DTFE/Vimo">Vimo源码</a>由<a href="https://github.com/jsdoc3/jsdoc">JSDoc3.5.5</a>自动生成。
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
