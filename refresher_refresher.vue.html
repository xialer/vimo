<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>refresher/refresher.vue - Documentation</title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="scripts/qrcode.js"></script>
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/custom.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>

    <section class="vimo">
        <div class="vimo__imgBox">
            <img class="vimo__imgBox--img" src="./asset/img/vimo.png">
        </div>

        <div class="vimo__title">
            <h2>VIMO</h2>
            <!--<p>beta</p>-->
            <p>基于Vue2.x的移动端Hybrid框架</p>
        </div>
        <div class="vimo__iframe">
            <iframe src="https://ghbtns.com/github-btn.html?user=DTFE&amp;repo=Vimo&amp;type=star&amp;count=true"
                    frameborder="0" scrolling="0" width="110px" height="20px"
                    class="enter-transition"
                    style=""></iframe>
            <iframe src="https://ghbtns.com/github-btn.html?user=DTFE&amp;repo=Vimo&amp;type=fork&amp;count=true"
                    frameborder="0" scrolling="0" width="95px" height="20px"
                    class="enter-transition"
                    style=""></iframe>
        </div>
    </section>
    <section class="nav__header"><h2><a href="index.html">首页 / Home</a></h2><h2><a href="https://dtfe.github.io/vimo-demo">示例 / Demo</a></h2><h2><a href="https://github.com/DTFE/vimo-start-kit">如何开始 / How To Start</a></h2><h2><a href="https://github.com/DTFE/Vimo/blob/master/CHANGELOG.md">更新日志 / Change Log</a></h2><h2><a href="#">常见问题 / Question</a></h2></section><h3>组件 / Components</h3><ul><li><a href="component-ActionSheet.html">ActionSheet</a><ul class='methods'><li data-type='method'><a href="component-ActionSheet.html#~dismiss">dismiss</a></li><li data-type='method'><a href="component-ActionSheet.html#~present">present</a></li></ul></li><li><a href="component-Alert.html">Alert</a><ul class='methods'><li data-type='method'><a href="component-Alert.html#~dismiss">dismiss</a></li><li data-type='method'><a href="component-Alert.html#~present">present</a></li></ul></li><li><a href="component-Avatar.html">Avatar</a></li><li><a href="component-Backdrop.html">Backdrop</a></li><li><a href="component-Badge.html">Badge</a></li><li><a href="component-Base_App.html">Base/App</a><ul class='methods'><li data-type='method'><a href="component-Base_App.html#~setClass">setClass</a></li><li data-type='method'><a href="component-Base_App.html#~setDisableScroll">setDisableScroll</a></li><li data-type='method'><a href="component-Base_App.html#~setDocTitle">setDocTitle</a></li><li data-type='method'><a href="component-Base_App.html#~setEnabled">setEnabled</a></li></ul></li><li><a href="component-Base_Content.html">Base/Content</a><ul class='methods'><li data-type='method'><a href="component-Base_Content.html#~getContentDimensions">getContentDimensions</a></li><li data-type='method'><a href="component-Base_Content.html#~resize">resize</a></li><li data-type='method'><a href="component-Base_Content.html#~scrollBy">scrollBy</a></li><li data-type='method'><a href="component-Base_Content.html#~scrollTo">scrollTo</a></li><li data-type='method'><a href="component-Base_Content.html#~scrollToBottom">scrollToBottom</a></li><li data-type='method'><a href="component-Base_Content.html#~scrollToElement">scrollToElement</a></li><li data-type='method'><a href="component-Base_Content.html#~scrollToTop">scrollToTop</a></li></ul></li><li><a href="component-Base_Footer.html">Base/Footer</a><ul class='methods'><li data-type='method'><a href="component-Base_Footer.html#~hide">hide</a></li><li data-type='method'><a href="component-Base_Footer.html#~setStyle">setStyle</a></li><li data-type='method'><a href="component-Base_Footer.html#~show">show</a></li><li data-type='method'><a href="component-Base_Footer.html#~toggle">toggle</a></li></ul></li><li><a href="component-Base_Header.html">Base/Header</a><ul class='methods'><li data-type='method'><a href="component-Base_Header.html#~hide">hide</a></li><li data-type='method'><a href="component-Base_Header.html#~setStyle">setStyle</a></li><li data-type='method'><a href="component-Base_Header.html#~show">show</a></li><li data-type='method'><a href="component-Base_Header.html#~toggle">toggle</a></li></ul></li><li><a href="component-Base_Nav.html">Base/Nav</a></li><li><a href="component-Base_Navbar.html">Base/Navbar</a><ul class='methods'><li data-type='method'><a href="component-Base_Navbar.html#~hideOptionButton">hideOptionButton</a></li><li data-type='method'><a href="component-Base_Navbar.html#~reset">reset</a></li><li data-type='method'><a href="component-Base_Navbar.html#~showOptionButton">showOptionButton</a></li><li data-type='method'><a href="component-Base_Navbar.html#~showPopMenu">showPopMenu</a></li></ul></li><li><a href="component-Base_Page.html">Base/Page</a></li><li><a href="component-Button.html">Button</a></li><li><a href="component-Card.html">Card</a></li><li><a href="component-Card_CardContent.html">Card/CardContent</a></li><li><a href="component-Card_CardHeader.html">Card/CardHeader</a></li><li><a href="component-Card_CardTitle.html">Card/CardTitle</a></li><li><a href="component-Checkbox.html">Checkbox</a></li><li><a href="component-ChooseCity.html">ChooseCity</a><ul class='methods'><li data-type='method'><a href="component-ChooseCity.html#~present">present</a></li></ul></li><li><a href="component-CityPicker.html">CityPicker</a></li><li><a href="component-Datetime.html">Datetime</a></li><li><a href="component-Fab.html">Fab</a><ul class='methods'><li data-type='method'><a href="component-Fab.html#~close">close</a></li></ul></li><li><a href="component-Fab_FabButton.html">Fab/FabButton</a></li><li><a href="component-Fab_FabList.html">Fab/FabList</a></li><li><a href="component-Feedback.html">Feedback</a><ul class='methods'><li data-type='method'><a href="component-Feedback.html#~destroy">destroy</a></li><li data-type='method'><a href="component-Feedback.html#~update">update</a></li></ul></li><li><a href="component-Grid.html">Grid</a></li><li><a href="component-Grid_Column.html">Grid/Column</a></li><li><a href="component-Grid_Row.html">Grid/Row</a></li><li><a href="component-Icon.html">Icon</a></li><li><a href="component-Img.html">Img</a></li><li><a href="component-Indicator.html">Indicator</a><ul class='methods'><li data-type='method'><a href="component-Indicator.html#.dismiss">dismiss</a></li><li data-type='method'><a href="component-Indicator.html#.present">present</a></li></ul></li><li><a href="component-InfiniteScroll.html">InfiniteScroll</a><ul class='methods'><li data-type='method'><a href="component-InfiniteScroll.html#~complete">complete</a></li><li data-type='method'><a href="component-InfiniteScroll.html#~enable">enable</a></li><li data-type='method'><a href="component-InfiniteScroll.html#~waitFor">waitFor</a></li></ul></li><li><a href="component-InfiniteScroll_InfiniteScrollContent.html">InfiniteScroll/InfiniteScrollContent</a></li><li><a href="component-Input.html">Input</a></li><li><a href="component-Item.html">Item</a></li><li><a href="component-Item_ItemDivider.html">Item/ItemDivider</a></li><li><a href="component-Item_ItemGroup.html">Item/ItemGroup</a></li><li><a href="component-Item_ListHeader.html">Item/ListHeader</a></li><li><a href="component-Label.html">Label</a></li><li><a href="component-List.html">List</a></li><li><a href="component-Loading.html">Loading</a><ul class='methods'><li data-type='method'><a href="component-Loading.html#~dismiss">dismiss</a></li><li data-type='method'><a href="component-Loading.html#~present">present</a></li></ul></li><li><a href="component-Menus.html">Menus</a><ul class='methods'><li data-type='method'><a href="component-Menus.html#~close">close</a></li><li data-type='method'><a href="component-Menus.html#~open">open</a></li><li data-type='method'><a href="component-Menus.html#~toggle">toggle</a></li></ul></li><li><a href="component-Modal.html">Modal</a><ul class='methods'><li data-type='method'><a href="component-Modal.html#~dismiss">dismiss</a></li><li data-type='method'><a href="component-Modal.html#~present">present</a></li></ul></li><li><a href="component-Note.html">Note</a></li><li><a href="component-NoticeBar.html">NoticeBar</a><ul class='methods'><li data-type='method'><a href="component-NoticeBar.html#~close">close</a></li></ul></li><li><a href="component-Picker.html">Picker</a><ul class='methods'><li data-type='method'><a href="component-Picker.html#~dismiss">dismiss</a></li><li data-type='method'><a href="component-Picker.html#~present">present</a></li></ul></li><li><a href="component-Popover.html">Popover</a><ul class='methods'><li data-type='method'><a href="component-Popover.html#~dismiss">dismiss</a></li><li data-type='method'><a href="component-Popover.html#~present">present</a></li></ul></li><li><a href="component-PreviewImage.html">PreviewImage</a></li><li><a href="component-Radio.html">Radio</a></li><li><a href="component-Range.html">Range</a></li><li><a href="component-Refresher.html">Refresher</a><ul class='methods'><li data-type='method'><a href="component-Refresher.html#~cancel">cancel</a></li><li data-type='method'><a href="component-Refresher.html#~complete">complete</a></li></ul></li><li><a href="component-Refresher_RefresherContent.html">Refresher/RefresherContent</a></li><li><a href="component-Scroll.html">Scroll</a></li><li><a href="component-ScrollSegment.html">ScrollSegment</a></li><li><a href="component-ScrollSegment_ScrollSegmentButton.html">ScrollSegment/ScrollSegmentButton</a></li><li><a href="component-Searchbar.html">Searchbar</a><ul class='methods'><li data-type='method'><a href="component-Searchbar.html#~setFocus">setFocus</a></li></ul></li><li><a href="component-Segment.html">Segment</a></li><li><a href="component-Segment_SegmentButton.html">Segment/SegmentButton</a></li><li><a href="component-Select.html">Select</a></li><li><a href="component-Select_SelectOption.html">Select/SelectOption</a></li><li><a href="component-Separation.html">Separation</a></li><li><a href="component-Sheet.html">Sheet</a><ul class='methods'><li data-type='method'><a href="component-Sheet.html#~dismiss">dismiss</a></li><li data-type='method'><a href="component-Sheet.html#~present">present</a></li></ul></li><li><a href="component-SlideBox.html">SlideBox</a><ul class='methods'><li data-type='method'><a href="component-SlideBox.html#~cancel">cancel</a></li><li data-type='method'><a href="component-SlideBox.html#~checking">checking</a></li><li data-type='method'><a href="component-SlideBox.html#~complete">complete</a></li><li data-type='method'><a href="component-SlideBox.html#~fail">fail</a></li></ul></li><li><a href="component-Slides.html">Slides</a></li><li><a href="component-Slides_Slide.html">Slides/Slide</a></li><li><a href="component-SlidesLite.html">SlidesLite</a></li><li><a href="component-SlidesLite_Slide.html">SlidesLite/Slide</a></li><li><a href="component-Spinner.html">Spinner</a></li><li><a href="component-Tabs.html">Tabs</a><ul class='methods'><li data-type='method'><a href="component-Tabs.html#~getActivatedIndex">getActivatedIndex</a></li><li data-type='method'><a href="component-Tabs.html#~getByIndex">getByIndex</a></li><li data-type='method'><a href="component-Tabs.html#~getSelected">getSelected</a></li><li data-type='method'><a href="component-Tabs.html#~select">select</a></li></ul></li><li><a href="component-Tabs_Tab.html">Tabs/Tab</a></li><li><a href="component-Textarea.html">Textarea</a><ul class='methods'><li data-type='method'><a href="component-Textarea.html#~destroy">destroy</a></li><li data-type='method'><a href="component-Textarea.html#~update">update</a></li></ul></li><li><a href="component-Thumbnail.html">Thumbnail</a></li><li><a href="component-Toast.html">Toast</a></li><li><a href="component-Toggle.html">Toggle</a></li><li><a href="component-Toolbar.html">Toolbar</a></li><li><a href="component-Toolbar_Buttons.html">Toolbar/Buttons</a></li><li><a href="component-Toolbar_Title.html">Toolbar/Title</a><ul class='methods'><li data-type='method'><a href="component-Toolbar_Title.html#~getTitle">getTitle</a></li><li data-type='method'><a href="component-Toolbar_Title.html#~reset">reset</a></li><li data-type='method'><a href="component-Toolbar_Title.html#~setTitle">setTitle</a></li><li data-type='method'><a href="component-Toolbar_Title.html#~setTitleColor">setTitleColor</a></li></ul></li></ul><h3>类 / Classes</h3><ul><li><a href="Config.html">Config</a><ul class='methods'><li data-type='method'><a href="Config.html#cache">cache</a></li><li data-type='method'><a href="Config.html#get">get</a></li><li data-type='method'><a href="Config.html#getBoolean">getBoolean</a></li><li data-type='method'><a href="Config.html#getNumber">getNumber</a></li><li data-type='method'><a href="Config.html#set">set</a></li><li data-type='method'><a href="Config.html#settings">settings</a></li></ul></li><li><a href="History.html">History</a><ul class='methods'><li data-type='method'><a href="History.html#canGoBack">canGoBack</a></li><li data-type='method'><a href="History.html#getDirection">getDirection</a></li><li data-type='method'><a href="History.html#getHistory">getHistory</a></li><li data-type='method'><a href="History.html#toRoot">toRoot</a></li></ul></li><li><a href="Platform.html">Platform</a><ul class='methods'><li data-type='method'><a href="Platform.html#exitApp">exitApp</a></li><li data-type='method'><a href="Platform.html#height">height</a></li><li data-type='method'><a href="Platform.html#is">is</a></li><li data-type='method'><a href="Platform.html#isLandscape">isLandscape</a></li><li data-type='method'><a href="Platform.html#isPortrait">isPortrait</a></li><li data-type='method'><a href="Platform.html#lang">lang</a></li><li data-type='method'><a href="Platform.html#navigatorPlatform">navigatorPlatform</a></li><li data-type='method'><a href="Platform.html#networkType">networkType</a></li><li data-type='method'><a href="Platform.html#onNetworkChange">onNetworkChange</a></li><li data-type='method'><a href="Platform.html#platforms">platforms</a></li><li data-type='method'><a href="Platform.html#ready">ready</a></li><li data-type='method'><a href="Platform.html#userAgent">userAgent</a></li><li data-type='method'><a href="Platform.html#versions">versions</a></li><li data-type='method'><a href="Platform.html#width">width</a></li></ul></li></ul><h3>模块 / Modules</h3><ul><li><a href="module-Util.html">Util</a><ul class='methods'><li data-type='method'><a href="module-Util.html#.clamp">clamp</a></li><li data-type='method'><a href="module-Util.html#.defaults">defaults</a></li><li data-type='method'><a href="module-Util.html#.docReady">docReady</a></li><li data-type='method'><a href="module-Util.html#.firstUpperCase">firstUpperCase</a></li><li data-type='method'><a href="module-Util.html#.focusOutActiveElement">focusOutActiveElement</a></li><li data-type='method'><a href="module-Util.html#.hasClass">hasClass</a></li><li data-type='method'><a href="module-Util.html#.hasFocus">hasFocus</a></li><li data-type='method'><a href="module-Util.html#.isActive">isActive</a></li><li data-type='method'><a href="module-Util.html#.isArray">isArray</a></li><li data-type='method'><a href="module-Util.html#.isBlank">isBlank</a></li><li data-type='method'><a href="module-Util.html#.isBoolean">isBoolean</a></li><li data-type='method'><a href="module-Util.html#.isCheckedProperty">isCheckedProperty</a></li><li data-type='method'><a href="module-Util.html#.isDate">isDate</a></li><li data-type='method'><a href="module-Util.html#.isDefined">isDefined</a></li><li data-type='method'><a href="module-Util.html#.isFunction">isFunction</a></li><li data-type='method'><a href="module-Util.html#.isNumber">isNumber</a></li><li data-type='method'><a href="module-Util.html#.isObject">isObject</a></li><li data-type='method'><a href="module-Util.html#.isPassive">isPassive</a></li><li data-type='method'><a href="module-Util.html#.isPlainObject">isPlainObject</a></li><li data-type='method'><a href="module-Util.html#.isPresent">isPresent</a></li><li data-type='method'><a href="module-Util.html#.isPrimitive">isPrimitive</a></li><li data-type='method'><a href="module-Util.html#.isRegexp">isRegexp</a></li><li data-type='method'><a href="module-Util.html#.isString">isString</a></li><li data-type='method'><a href="module-Util.html#.isTrueProperty">isTrueProperty</a></li><li data-type='method'><a href="module-Util.html#.isUndefined">isUndefined</a></li><li data-type='method'><a href="module-Util.html#.parsePxUnit">parsePxUnit</a></li><li data-type='method'><a href="module-Util.html#.pointerCoord">pointerCoord</a></li><li data-type='method'><a href="module-Util.html#.registerListener">registerListener</a></li><li data-type='method'><a href="module-Util.html#.setElementClass">setElementClass</a></li><li data-type='method'><a href="module-Util.html#.transitionEnd">transitionEnd</a></li><li data-type='method'><a href="module-Util.html#.urlChange">urlChange</a></li></ul></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">

    <article class="content">

        
        <h1 class="page-title">refresher/refresher.vue</h1>
        

        




    <section>
        <article>
            <pre class="prettyprint source linenums"><code>&lt;template>
    &lt;div class="ion-refresher" :class="{'refresher-active':(state !== 'inactive')}" :style="{'top':top}" :state="state">
        &lt;slot>&lt;/slot>
    &lt;/div>
&lt;/template>
&lt;style lang="less">
    @import "refresher";
&lt;/style>
&lt;script type="text/javascript">
  /**
   * @component Refresher
   * @description
   *
   * ## 数据加载 / Refresher下拉刷新组件
   *
   * ### 说明
   *
   * Refresher组件是在Content组件下使用, 并提供了下拉刷新的功能. 使用前需要将Refresher组件放在Content组件内所有内容的前面, 并加上`slot="refresher"`属性. 如果Refresher组件使用完毕希望禁用, 请使用`enabled`属性, 而不是使用`v-if`指令.
   *
   * ### 事件
   *
   * 事件传递组件的this, 可用的两个方法为: complete/cancel. 当然可以使用ref获取组件的实例
   *
   * ### 注意
   *
   * 目前这个组件只适合在原生滚动下使用, 当使用js滚动时会异常
   *
   * ### 关于指示器RefresherContent
   *
   * 这个组件是可以定制化的
   *
   * @props {Number} [closeDuration=280] - 回复到 inactive 状态的动画时间
   * @props {Boolean} [enabled=true] - 组件是否可用
   * @props {Number} [pullMax=200] - 下拉的最大值, 超过则直接进入 refreshing状态
   * @props {Number} [pullMin=70] - 下拉进入refreshing状态的最小值
   * @props {Number} [snapbackDuration=280] - 回复到 refreshing 状态的动画时间
   *
   * @fires component:Refresher#onRefresh - 进入 refreshing 状态时触发, 事件传递组件的this
   * @fires component:Refresher#onPull - 下拉并且看到了refresher, 事件传递组件的this
   * @fires component:Refresher#onStart - 开始下拉的事件, 事件传递组件的this
   *
   * @slot 空 - 指示器RefresherContent组件的插槽
   *
   * @demo #/refresher
   * @see component:Base/Content
   * @usage
   * &lt;Page>
   *    &lt;Header>
   *        &lt;Navbar>
   *            &lt;Title>Refresher&lt;/Title>
   *        &lt;/Navbar>
   *    &lt;/Header>
   *    &lt;Content>
   *        &lt;Refresher slot="refresher" @onRefresh="doRefresh($event)" @onPull="doPulling($event)">
   *            &lt;RefresherContent pullingText="下拉刷新..." refreshingText="正在刷新...">&lt;/RefresherContent>
   *            &lt;/Refresher>
   *        &lt;List>
   *            &lt;Item v-for="i in list">{{i}}&lt;/Item>
   *        &lt;/List>
   *    &lt;/Content>
   * &lt;/Page>
   *
   *
   * // ...
   *
   * methods: {
   *    doRefresh(ins){
   *      let _start = this.i;
   *      setTimeout(() => {
   *        for (; (10 + _start) > this.i; this.i++) {
   *          this.list.unshift(`item - ${this.i}`)
   *        }
   *        // 当前异步完成
   *        ins.complete();
   *        console.debug('onInfinite-complete')
   *      }, 500)
   *    },
   *  },
   * */

  import { setElementClass, registerListener, pointerCoord } from '../util/util'

  const STATE_INACTIVE = 'inactive'
  const STATE_PULLING = 'pulling'
  const STATE_READY = 'ready'
  const STATE_REFRESHING = 'refreshing'
  const STATE_CANCELLING = 'cancelling'
  const STATE_COMPLETING = 'completing'
  const DAMP = 0.5// 滑动阻尼
  export default {
    name: 'Refresher',
    data () {
      return {
        // -------- public --------
        /**
         * @name state
         * @type {number}
         * @description Refresher 的状态, 可以使下面的一个值:
         * - `inactive` - Refresher 当前时隐藏状态, 没有下拉 或者 刷新
         * - `pulling` - Refresher 当前正在被下拉, 但是还没达到触发刷新的点
         * - `cancelling` - 还没达到触发刷新的点时, 用户松手, 动画恢复完毕后改为`inactive`状态
         * - `ready` - 用户已经下拉到达触发点, 如果用户松手, 则进入`refreshing`状态
         * - `refreshing` - Refresher 处于刷新状态, 等待异步操作的完成. 一旦执行了refresh的 `complete()` 方法, Refresher  将进入 `completing` 状态.
         * - `completing` - Refresher 的`refreshing` 状态结束, Refresher之后会执行关闭的动画, 如果动画结束, 则回退到`inactive` 状态.
         * */
        state: STATE_INACTIVE,

        /**
         * @name startY
         * @type {Number}
         * @description 下拉的起始点
         * */
        startY: null, // 下拉的起始点
        /**
         * @name currentY
         * @type {Number}
         * @description 当前的点
         * */
        currentY: null, // 当前的点
        /**
         * @name deltaY
         * @type {Number}
         * @description 起始点和当前点的距离
         * */
        deltaY: null, // 起始点和当前点的距离
        /**
         * @name progress
         * @type {Number}
         * @description 表示对当前进度.
         * - 0: 原始状态,为下拉
         * - =1: 到达refreshing状态的最小值
         * - \>1: 超过refreshing状态的最小值
         * */
        progress: null, // 表示对当前进度. 0:原始状态,为下拉; >1: 刷新开始

        // -------- private --------
        contentComponent: null, // Content组件的this
        appliedStyles: false,
        didStart: false,
        lastCheck: 0,
        // TODO: 解决下这里
        pointerEvents: null,
        unregs: [], // 解绑的事件列表
        damp: DAMP, // 滑动阻尼
        top: null // style的top
      }
    },
    props: {
      // 回复到 inactive 状态的时间
      closeDuration: {
        type: Number,
        default: 280
      },
      enabled: {
        type: Boolean,
        default: true
      },
      // 下拉的最大值, 超过则拉不动
      pullMax: {
        type: Number,
        default: 200
      },
      // 下拉进入refreshing状态的最小值
      pullMin: {
        type: Number,
        default: 70
      },
      // 回复到 refreshing 状态的时间
      snapbackDuration: {
        type: Number,
        default: 280
      }
    },
    watch: {
      enabled (val) {
        this.setListeners(val)
      }
    },
    methods: {
      // -------- public --------
      /**
       * @function complete
       * @description
       * 异步数据请求成功后, 调用这个方法; refresher将会关闭,
       * 状态由`refreshing` -> `completing`.
       */
      complete () {
        this.closeRefresher(STATE_COMPLETING, '120ms')
        // 重新计算尺寸, 必须
        this.contentComponent.resize()
      },

      /**
       * @function cancel
       * @description
       * 取消 refresher, 其状态由`refreshing` -> `cancelling`
       */
      cancel () {
        this.closeRefresher(STATE_CANCELLING, '')
      },

      // -------- private --------
      init () {
        let _pageComponentChildrenList = this.$vnode.context.$children[0].$children || []
        _pageComponentChildrenList.forEach((component) => {
          if (component.$options._componentTag.toLowerCase() === 'content') {
            this.contentComponent = component
          }
        })
        console.assert(this.contentComponent, 'Refresher组件必须要在Content组件下使用')

        setElementClass(this.contentComponent.$el, 'has-refresher', true)

        this.setListeners(this.enabled)
      },

      /**
       * @param {Boolean} shouldListen -
       * */
      setListeners (shouldListen) {
        // 如果解绑函数存在则全部解绑
        if (this.unregs &amp;&amp; this.unregs.length > 0) {
//          console.debug('refresher.vue 解除绑定')
          this.unregs.forEach((_unreg) => {
            _unreg &amp;&amp; _unreg()
          })
        }

        // 如果为true, 则添加事件监听
        // 等待Content完毕
        this.$nextTick(() => {
          if (shouldListen) {
            let contentElement = this.contentComponent.getScrollElement()
            console.assert(contentElement, 'Refresh Component need Content Ready!::&lt;Component>setListeners()')
            // TODO: 对于点击事件应该同一封装一层
            registerListener(contentElement, 'touchstart', this.pointerDownHandler.bind(this), {'passive': false}, this.unregs)
            registerListener(contentElement, 'mousedown', this.pointerDownHandler.bind(this), {'passive': false}, this.unregs)

            registerListener(contentElement, 'touchmove', this.pointerMoveHandler.bind(this), {'passive': false}, this.unregs)
            registerListener(contentElement, 'mousemove', this.pointerMoveHandler.bind(this), {'passive': false}, this.unregs)

            registerListener(contentElement, 'touchend', this.pointerUpHandler.bind(this), {'passive': false}, this.unregs)
            registerListener(contentElement, 'mouseup', this.pointerUpHandler.bind(this), {'passive': false}, this.unregs)
          }
        })
      },

      /**
       * @param {TouchEvent} ev - 点击事件
       * */
      pointerDownHandler (ev) {
        // 如果多点触摸, 则直接返回
        if (ev.touches &amp;&amp; ev.touches.length > 1) {
          return false
        }
        if (this.state !== STATE_INACTIVE) {
          return false
        }

        let contentDimensions = this.contentComponent.getContentDimensions()
        let scrollHostScrollTop = contentDimensions.scrollTop
        // 如果当前的scrollTop大于0, 意味着页面在别的位置, 不是停在顶部, 不是在refresher状态, 直接退出
        if (scrollHostScrollTop > 0) {
          return false
        }

        let coord = pointerCoord(ev)
//        console.debug('Pull-to-refresh, onStart', ev.type, 'y:', coord.y)

        // refresher定位
        if (contentDimensions.contentTop > 0) {
          let newTop = contentDimensions.contentTop + 'px'
          if (this.top !== newTop) {
            this.top = newTop
          }
        }

        // 记录开始位置
        this.startY = this.currentY = coord.y
        this.progress = 0
        this.state = STATE_INACTIVE

        return true
      },
      /**
       * @param {TouchEvent} ev - 点击事件
       * */
      pointerMoveHandler (ev) {
        // 滑动部分的处理函数在滑动过程中会执行很多次, 因此会有节流的处理,
        // 另外DOM的操作除非必要, 否则不进行
        // 多点触摸则直接返回
        if (ev.touches &amp;&amp; ev.touches.length > 1) {
          return 1
        }

        // 以下状态将返回
        // 没有开始位置/正在refreshing状态/正在closing(cancelling/completing)
        if (this.startY === null || this.state === STATE_REFRESHING || this.state === STATE_CANCELLING || this.state === STATE_COMPLETING) {
          return 2
        }

        // 在16ms之内如果连续触发,则不处理(节流)
        let now = Date.now()
        const T = 16
        if (this.lastCheck + T > now) {
          return 3
        }

        // 节流 -- 记录上次的节流时间
        this.lastCheck = now

        let coord = pointerCoord(ev)
        this.currentY = coord.y

        // 记录拉动的距离
        this.deltaY = (coord.y - this.startY)

        // 当前是向上滑动, 所以应该设置state为inactive
        if (this.deltaY &lt;= 0) {
          // 这个是向上滚动, 没使用 refresher 的功能, 故现在是inactive状态
          this.progress = 0

          if (this.state !== STATE_INACTIVE) {
            this.state = STATE_INACTIVE
          }

          if (this.appliedStyles) {
            // reset the styles only if they were applied
            this.setCss(0, '', false, '') // y/duration/overflow/delay
            return 5
          }

          return 6
        }

        // 正式进入 refresher
        if (this.state === STATE_INACTIVE) {
          let scrollHostScrollTop = this.contentComponent.getContentDimensions().scrollTop
          if (scrollHostScrollTop > 0) {
            this.progress = 0
            this.startY = null
            return 7
          }

          // 步入正题
          this.state = STATE_PULLING
        }

        if (!this.deltaY) {
          this.progress = 0
          return 8
        }

        // prevent native scroll events
        ev.preventDefault()

        // 进入 pulling 状态, 开始移动scroll element
        this.setCss((this.deltaY * this.damp), '0ms', true, '')

        // 进行滚动吧
        this.goScroll()
      },

      goScroll () {
        // set pull progress
        this.progress = (this.deltaY * this.damp / this.pullMin)

        // 对外发送 onStart 事件
        if (!this.didStart) {
          this.didStart = true
          /**
           * @event component:Refresher#onStart
           * @description 开始下拉的事件, 事件传递组件的this
           * @property {RefreshComponent} this - 组件实例
           */
          this.$emit('onStart', this)
        }

        // 对外发送 onPull 事件
        /**
         * @event component:Refresher#onPull
         * @description 下拉并且看到了refresher, 事件传递组件的this
         * @property {RefreshComponent} this - 组件实例
         */
        this.$emit('onPull', this)

        // do nothing if the delta is less than the pull threshold
        if (this.deltaY * this.damp &lt; this.pullMin) {
          // ensure it stays in the pulling state, cuz its not ready yet
          this.state = STATE_PULLING
          return 2
        }

        if (this.deltaY * this.damp > this.pullMax) {
          // they pulled farther than the max, so kick off the refresh
          this.beginRefresh()
          return 3
        }

        // 正好在最大和最小值之间, 进入 ready 状态吧
        this.state = STATE_READY

        return 4
      },
      pointerUpHandler () {
        if (this.state === STATE_READY) {
          this.beginRefresh()
        } else if (this.state === STATE_PULLING) {
          // 返回原点
          this.cancel()
        }
        // reset
        this.startY = null
      },
      beginRefresh () {
        this.state = STATE_REFRESHING

        // 将content放置在开口处
        this.setCss(this.pullMin, (this.snapbackDuration + 'ms'), true, '')

        // 发送事件 onRefresh
        /**
         * @event component:Refresher#onRefresh
         * @description 进入 refreshing 状态时触发, 事件传递组件的this
         * @property {RefreshComponent} this - 组件实例
         */
        this.$emit('onRefresh', this)
      },
      /**
       * @param {string} state
       * @param {string} delay
       * */
      closeRefresher (state, delay) {
        var timer // number

        function close (ev) {
          // closing is done, return to inactive state
          if (ev) {
            clearTimeout(timer)
          }

          this.state = STATE_INACTIVE
          this.progress = 0
          this.didStart = this.startY = this.currentY = this.deltaY = null
          this.setCss(0, '0ms', false, '')
        }

        // create fallback timer incase something goes wrong with transitionEnd event
        timer = window.setTimeout(close.bind(this), 600)

        // create transition end event on the content's scroll element
        this.contentComponent.onScrollElementTransitionEnd(close.bind(this))

        // reset set the styles on the scroll element
        // set that the refresh is actively cancelling/completing
        this.state = state
        this.setCss(0, '', true, delay)
      },

      /**
       * @param {Number} y -
       * @param {String} duration -
       * @param {Boolean} overflowVisible -
       * @param {String} delay -
       **/
      setCss (y, duration, overflowVisible, delay) {
        this.appliedStyles = (y > 0)
        const Css = this.$platform.css
        console.assert(Css, '无法获取platform中的css样式定义,refresher/refresher.vue::&lt;Function>setCss()')
        this.contentComponent.setScrollElementStyle(Css.transform, ((y > 0) ? 'translateY(' + y + 'px) translateZ(0px)' : 'translateZ(0px)'))
        this.contentComponent.setScrollElementStyle(Css.transitionDuration, duration)
        this.contentComponent.setScrollElementStyle(Css.transitionDelay, delay)
        this.contentComponent.setScrollElementStyle('overflow', (overflowVisible ? 'hidden' : ''))
      }
    },
    mounted () {
      console.assert(this.$platform, `Refersher组件需要在Platform模块中使用`)
      console.assert(this.$platform, `Refersher组件需要在Content组件中使用`)
      // 需要等待父元素mounted, 故这里初始化需要延迟
      this.$nextTick(() => { this.init() })
    }
  }
&lt;/script>
</code></pre>
        </article>
    </section>





    </article>
</div>

<br class="clear">

<!--<footer>-->
    <!--文档根据<a href="https://github.com/DTFE/Vimo">Vimo源码</a>由<a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>自动生成, 主题修改自<a href="https://github.com/clenemt/docdash">docdash</a>, 并增加了 @component / @demo / @props / @slot / @usage 增强标注.-->
<!--</footer>-->

<footer>
    文档根据<a href="https://github.com/DTFE/Vimo">Vimo源码</a>由<a href="https://github.com/jsdoc3/jsdoc">JSDoc3.5.5</a>自动生成。
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
